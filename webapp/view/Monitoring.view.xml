<mvc:View controllerName="sap.ibso.skyeyeForCdc.controller.Monitoring" 
	xmlns:mvc="sap.ui.core.mvc" displayBlock="true" 
	xmlns="sap.m" 
	xmlns:f="sap.f" 
	xmlns:l="sap.ui.layout" 
	xmlns:leaflet="sap.vco.leaflet.controls" 
	xmlns:echarts="sap.vco.echarts.controls" 
	xmlns:ng="sap.suite.ui.commons.networkgraph" 
	xmlns:ng.layout="sap.suite.ui.commons.networkgraph.layout" 
	xmlns:fc="sap.f.cards" 
	xmlns:core="sap.ui.core">
	<l:Splitter>
		<l:FixFlex fixFirst="false">
			<l:layoutData>
				<l:SplitterLayoutData size="15rem" resizable="false" />
			</l:layoutData>
			<l:flexContent>
				<ScrollContainer vertical="true" horizontal="false" height="100%" width="100%">
					<Tree items="{path:'orgUnit>/', parameters: { numberOfExpandedLevels: 4 }}" mode="SingleSelectMaster">
						<StandardTreeItem title="{orgUnit>text}" counter="{orgUnit>confirmed}" highlight="{orgUnit>status}" />
					</Tree>
				</ScrollContainer>
			</l:flexContent>
			<l:fixContent>
				<List>
					<InputListItem label="区块风险层级">
						<Select id="levelSelect" selectedKey="{pageConfig>/BlockRiskLevel}" change="onChangeLevel">
							<core:Item key="1" text="市" />
							<core:Item key="2" text="区" />
							<core:Item key="3" text="街道" />
							<core:Item key="4" text="社区" />
							<core:Item key="5" text="楼栋" />
						</Select>
					</InputListItem>
					<InputListItem label="层级地图跟随">
						<Switch state="{pageConfig>/AutoLevel}" />
					</InputListItem>
				</List>
			</l:fixContent>
		</l:FixFlex>
		<leaflet:Map id="map" zoom="15" center="[31.2, 121.6]" zoomControl="false" press="onPressMap">
			<leaflet:layerGroups>
				<leaflet:LayerGroup id="blockRisk" layers="{block>/}" visible="{pageConfig>/BlockRiskVisible}">
					<leaflet:Polygon press="onPressBlock" latLngs="{block>LatLngs}" style='\{ "stroke": true, "color": "{= ${block>Status} === "Good" ? "#107e3e" : "#e9730c"}", "opacity": 0.3, "fillOpacity": 0.2 \}' />
				</leaflet:LayerGroup >
				<leaflet:LayerGroup id="hospital" layers="{hospital>/}" visible="{pageConfig>/HospitalVisible}">
					<leaflet:Marker press="onPressHospital" latLng="{hospital>LatLng}" />
				</leaflet:LayerGroup >
				<leaflet:LayerGroup layers="{path:'case>/'}" zIndex="450" visible="{pageConfig>/CaseVisible}">
					<leaflet:LayerGroup>
						<leaflet:Marker press="onPressCase" latLng="{case>LatLng}" />
						<leaflet:LayerGroup layers="{path:'case>Trace',templateShareable:true}" visible="{pageConfig>/CaseTraceVisible}">
							<leaflet:CircleMarker press="onPressCase" radius="30" style='\{ "stroke": true, "color": "#bb0000", "opacity": 0.5, "bubblingMouseEvents":false \}' latLng="{case>LatLng}" />
						</leaflet:LayerGroup >
					</leaflet:LayerGroup >
				</leaflet:LayerGroup >
			</leaflet:layerGroups>
			<leaflet:layers>
				<leaflet:TileLayer url="https://api.tiles.mapbox.com/v4/[s]/[z]/[x]/[y].png?access_token=[accessToken]">
					<leaflet:customData>
						<core:CustomData key="maxZoom" value="18" />
						<core:CustomData key="s" value="mapbox.streets" />
						<core:CustomData key="accessToken" value="pk.eyJ1Ijoic3RyaW5nMTIyNSIsImEiOiJjanlqbjU3dTQwNWh1M29wcWg2Y2RxM3dxIn0.6oYP1O8MUA0RlLHZwa2JEQ" />
					</leaflet:customData>
				</leaflet:TileLayer>
			</leaflet:layers>
			<leaflet:floatingItems>
				<leaflet:FloatingItem top="1rem" left="1rem">
					<f:Card class="myCard" width="13rem">
						<f:layoutData>
							<f:GridContainerItemLayoutData columns="2" />
						</f:layoutData>
						<f:header>
							<fc:Header title="任务执行情况" subtitle="2020年2月1日" iconSrc="sap-icon://activities" />
						</f:header>
						<f:content>
							<List>
								<ObjectListItem title="已完成任务" number="106" highlight="Success"></ObjectListItem>
								<ObjectListItem title="待完成任务" number="16" highlight="Warning"></ObjectListItem>
								<ObjectListItem title="已下发通知" number="32" highlight="Information"></ObjectListItem>
							</List>
						</f:content>
					</f:Card>
				</leaflet:FloatingItem>
				<leaflet:FloatingItem top="1rem" left="15rem">
					<f:Card class="myCard" width="15rem">
						<f:header>
							<fc:NumericHeader title="管控人数" subtitle="2020年2月1日" number="5" trend="Down" state="Good" details="确诊病例" press="onPressWorkOrderCard">
								<fc:sideIndicators>
									<fc:NumericSideIndicator title="疑似病例" number="69" />
									<fc:NumericSideIndicator title="密切接触者" number="123" />
								</fc:sideIndicators>
							</fc:NumericHeader>
						</f:header>
						<f:content>
							<echarts:Instance class="sapUiTinyMarginTopBottom" id="chart-trend" option="{trendOption>/}" dataset="{trend>/}" width="100%" height="5rem">
							</echarts:Instance>
						</f:content>
					</f:Card>
				</leaflet:FloatingItem>
				<leaflet:FloatingItem top="1rem" right="1rem">
					<Panel width="8rem" class="floatingPanel sapUiNoContentPadding">
						<headerToolbar>
							<Toolbar design="Solid">
								<ToolbarSpacer width="0.5rem" />
								<core:Icon src="sap-icon://map-2" />
								<Text text="图层" />
							</Toolbar>
						</headerToolbar>
						<VBox>
							<CheckBox text="区块风险" selected="{pageConfig>/BlockRiskVisible}" />
							<CheckBox text="医疗机构" selected="{pageConfig>/HospitalVisible}" />
							<CheckBox text="病例" selected="{pageConfig>/CaseVisible}" select="onChangeCaseVisible" />
							<CheckBox text="病例活动行迹" selected="{pageConfig>/CaseTraceVisible}" enabled="{pageConfig>/CaseVisible}" />
						</VBox>
					</Panel>
				</leaflet:FloatingItem>
				<leaflet:FloatingItem id="caseDetailContainer" bottom="1rem" left="1rem" right="1rem" visible="false">
					<HBox width="100%" height="100%" justifyContent="Center" fitContainer="true">
						<HeaderContainer class="myHeaderContainer floatingPanel">
							<content>
								<HBox>
									<VBox class="myCarDetailTile">
										<HBox alignItems="Center">
											<VBox class="sapUiSmallMarginBeginEnd">
												<layoutData>
													<FlexItemData growFactor="1" />
												</layoutData>
												<Title text="{case>Name}" titleStyle="H2" class="sapUiSmallMarginTop" />
												<ObjectStatus text="{case>Type} - {case>Status}" state="{case>State}" class="sapUiSmallMarginTop" />
											</VBox>
											<Button type="Transparent" icon="sap-icon://display" tooltip="Check Detail" press="onPressEquipmentDetailCard" />
											<Button type="Transparent" icon="sap-icon://activities" tooltip="New Task" press="onCreateNewWorkOrder" />
										</HBox>
										<HBox class="sapUiSmallMarginBegin sapUiSmallMarginTop">
											<VBox>
												<Text width="9rem" class="sapUiSmallMarginEnd" text="感染日期" />
												<Text text="{case>InfectedDate}" />
											</VBox>
											<VBox>
												<Text class="sapUiSmallMarginEnd" text="发病日期" />
												<Text text="{case>SymptomDate}" />
											</VBox>
										</HBox>
										<HBox class="sapUiSmallMarginBegin sapUiSmallMarginTop">
											<VBox>
												<Text width="9rem" class="sapUiSmallMarginEnd" text="隔离日期" />
												<Text text="{case>SeparatedDate}" />
											</VBox>
											<VBox>
												<Text class="sapUiSmallMarginEnd" text="确诊日期" />
												<Text text="{case>ConfirmedDate}" />
											</VBox>
										</HBox>
										<HBox class="sapUiSmallMarginBegin sapUiTinyMarginTop">
											<VBox>
												<Text width="9rem" class="sapUiSmallMarginEnd" text="所属区块" />
												<Link text="{case>Region}" />
											</VBox>
											<VBox>
												<Text class="sapUiSmallMarginEnd" text="收治机构" />
												<Link text="{case>Hospital}" />
											</VBox>
										</HBox>
									</VBox>
								</HBox>
								<HBox alignItems="Center" class="myCarDetailTile">
									<!-- <Image src="image/networkSample.png" width="50rem" height="14rem" /> -->
									<ng:Graph id="graph" enableWheelZoom="false" nodes="{case>ContactTrace/Nodes}" lines="{case>ContactTrace/Lines}" width="50rem" height="17rem" graphReady="onGraphReady">
										<ng:layoutAlgorithm>
											<ng.layout:ForceDirectedLayout id="fdl" optimalDistanceConstant="0.31" maxIterations="200" maxTime="500" initialTemperature="200" coolDownStep="1" staticNodes="[0,0,1,2,3,4,5,6,100]">
											</ng.layout:ForceDirectedLayout>
										</ng:layoutAlgorithm>
										<ng:nodes>
											<ng:Node key="{case>Key}" title="{case>Title}" icon="{case>Icon}" attributes="{path:'case>Attributes', templateShareable:true}" shape="{case>Shape}" status="{case>Status}" x="{= Number(${case>Key}) * 100}" y="0">
												<ng:attributes>
													<ng:ElementAttribute label="{case>Label}" value="{case>Value}" />
												</ng:attributes>
											</ng:Node>
										</ng:nodes>
										<ng:lines>
											<ng:Line from="{case>From}" to="{case>To}" status="{case>Status}">
											</ng:Line>
										</ng:lines>
									</ng:Graph>
								</HBox>
								<Panel headerText="密切接触者" width="15rem" height="17rem" class="myCarDetailTile sapUiNoContentPadding">
									<List items="{case>Contacts}">
										<StandardListItem title="{case>Name}" info="{case>Type} - {case>Status}" infoState="{case>State}" />
									</List>
								</Panel>
							</content>
						</HeaderContainer>
					</HBox>
				</leaflet:FloatingItem>
			</leaflet:floatingItems>
		</leaflet:Map>
	</l:Splitter>
</mvc:View>